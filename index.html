<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ÁàÜÂºæ„Ç∑„É•„Éº„ÉÜ„Ç£„É≥„Ç∞„Ç≤„Éº„É†</title>
<style>
  body { text-align: center; font-family: sans-serif; }
  #gameArea { 
    width: 600px; height: 400px; border: 2px solid black; 
    margin: 20px auto; position: relative; background: #eee; overflow: hidden;
  }
  #player { 
    width: 50px; height: 20px; background: blue; 
    position: absolute; bottom: 0; left: 275px; 
  }
  .bomb { 
    width: 40px; height: 40px; border-radius: 50%; 
    background: red; position: absolute; 
  }
  /* üîΩ Âºæ„ÇíÂ§ß„Åç„Åè„Åó„ÅüÈÉ®ÂàÜ */
  .bullet { 
    width: 15px; height: 25px; 
    background: black; 
    border-radius: 50%; /* ‰∏∏„Å£„ÅΩ„Åè„Åô„Çã */
    position: absolute; 
  }
  button { 
    padding: 10px 20px; font-size: 16px; margin-top: 15px;
  }
  #restartBtn, #startBtn {
    display: none;
  }
  #instruction { 
    font-size: 18px; color: #d00; font-weight: bold; 
  }
  #countdown {
    font-size: 60px;
    color: #333;
    position: absolute;
    top: 40%;
    left: 0;
    width: 100%;
    text-align: center;
    font-weight: bold;
  }
  #status {
    font-size: 28px;
    color: #d00;
    font-weight: bold;
  }
</style>
</head>
<body>
<h1>ÁàÜÂºæ„Ç∑„É•„Éº„ÉÜ„Ç£„É≥„Ç∞„Ç≤„Éº„É†</h1>
<p id="instruction">‚ö†Ô∏è „Çπ„Éö„Éº„Çπ„Ç≠„Éº„Åß„Åü„Åæ„Çí„ÅØ„Å£„Åó„ÇÉ„ÄÄ‚Üê‚Üí„Ç≠„Éº„Åß„ÅÑ„Å©„ÅÜ</p>
<p>„Çπ„Ç≥„Ç¢: <span id="score">0</span></p>

<div id="gameArea">
  <div id="player"></div>
  <div id="countdown"></div>
</div>

<p id="status"></p>
<button id="startBtn">„Çπ„Çø„Éº„Éà</button>
<button id="restartBtn">„ÇÑ„ÇäÁõ¥„Åó</button>

<script>
const gameArea = document.getElementById('gameArea');
const player = document.getElementById('player');
const scoreDisplay = document.getElementById('score');
const status = document.getElementById('status');
const restartBtn = document.getElementById('restartBtn');
const startBtn = document.getElementById('startBtn');
const countdown = document.getElementById('countdown');

let score, gameOver, spawnInterval, fallSpeed, playerX, keys;
let gameStarted = false;

function initGame() {
    score = 0;
    gameOver = false;
    spawnInterval = 2000;
    fallSpeed = 2;
    playerX = 275;
    keys = {};
    scoreDisplay.textContent = score;
    status.textContent = "";
    restartBtn.style.display = "none";
    player.style.left = playerX + 'px';
    document.querySelectorAll('.bomb').forEach(b => b.remove());
    document.querySelectorAll('.bullet').forEach(b => b.remove());
}

function startCountdown(callback) {
    let count = 3;
    countdown.textContent = count;
    const timer = setInterval(() => {
        count--;
        if (count > 0) {
            countdown.textContent = count;
        } else {
            clearInterval(timer);
            countdown.textContent = "„Çπ„Çø„Éº„ÉàÔºÅ";
            setTimeout(() => {
                countdown.textContent = "";
                callback();
            }, 800);
        }
    }, 1000);
}

function startGame() {
    startBtn.style.display = "none";
    gameStarted = true;
    initGame();
    startCountdown(() => {
        gameLoop();
        playerLoop();
    });
}

function endGame() {
    status.textContent = "üíÄ GAME OVER üíÄ";
    gameOver = true;
    restartBtn.style.display = "inline-block";
}

document.addEventListener('keydown', e => keys[e.key] = true);
document.addEventListener('keyup', e => keys[e.key] = false);

function movePlayer() {
    if (keys['ArrowLeft']) playerX = Math.max(0, playerX - 5);
    if (keys['ArrowRight']) playerX = Math.min(gameArea.clientWidth - 50, playerX + 5);
    player.style.left = playerX + 'px';
}

document.addEventListener('keydown', e => {
    if (e.key === ' ' && gameStarted && !gameOver) shoot();
});

function shoot() {
    let bullet = document.createElement('div');
    bullet.classList.add('bullet');
    let bulletY = gameArea.clientHeight - 40;
    let bulletX = playerX + 18;
    bullet.style.left = bulletX + 'px';
    bullet.style.top = bulletY + 'px';
    gameArea.appendChild(bullet);

    function moveBullet() {
        if (gameOver) return;
        bulletY -= 8;
        bullet.style.top = bulletY + 'px';
        if (bulletY < 0) {
            if (gameArea.contains(bullet)) gameArea.removeChild(bullet);
            return;
        }
        document.querySelectorAll('.bomb').forEach(bomb => {
            const bombRect = bomb.getBoundingClientRect();
            const bulletRect = bullet.getBoundingClientRect();
            if (!(bulletRect.right < bombRect.left || bulletRect.left > bombRect.right || bulletRect.bottom < bombRect.top || bulletRect.top > bombRect.bottom)) {
                if (gameArea.contains(bomb)) gameArea.removeChild(bomb);
                if (gameArea.contains(bullet)) gameArea.removeChild(bullet);
                score += 1;
                scoreDisplay.textContent = score;
            }
        });
        requestAnimationFrame(moveBullet);
    }
    moveBullet();
}

function createBomb() {
    if (gameOver) return;
    let bomb = document.createElement('div');
    bomb.classList.add('bomb');
    let x = Math.random() * (gameArea.clientWidth - 40);
    let y = -40;
    bomb.style.left = x + 'px';
    bomb.style.top = y + 'px';
    gameArea.appendChild(bomb);

    function fall() {
        if (gameOver) return;
        y += fallSpeed;
        bomb.style.top = y + 'px';
        if (y + 40 >= gameArea.clientHeight) {
            if (gameArea.contains(bomb)) {
                endGame();
            }
            return;
        }
        requestAnimationFrame(fall);
    }
    fall();
}

function gameLoop() {
    if (!gameOver) {
        createBomb();
        spawnInterval = Math.max(500, spawnInterval * 0.95);
        fallSpeed += 0.05;
        setTimeout(gameLoop, spawnInterval);
    }
}

function playerLoop() {
    if (!gameOver) {
        movePlayer();
        requestAnimationFrame(playerLoop);
    }
}

restartBtn.addEventListener('click', () => {
    restartBtn.style.display = "none";
    startBtn.style.display = "inline-block";
});
startBtn.addEventListener('click', startGame);

startBtn.style.display = "inline-block";
</script>
</body>
</html>

